var userName,userEmail,userId,quill,appPage="/campaigns",termsPage="/terms",homePage="/",loginPage="/login",editorPage="/editor",userPremium=!1,campaignInfo=new Object,campaignList=document.getElementById("campaignList"),quillLoaded=!1,commandList=document.getElementById("commands");if("page__login"==document.body.className){console.log("navigated to login.html");var uiConfig={callbacks:{signInSuccessWithAuthResult:function(e,n){return!0}},credentialHelper:firebaseui.auth.CredentialHelper.NONE,signInFlow:"popup",signInSuccessUrl:appPage,signInOptions:[firebase.auth.EmailAuthProvider.PROVIDER_ID,firebase.auth.TwitterAuthProvider.PROVIDER_ID,firebase.auth.FacebookAuthProvider.PROVIDER_ID,firebase.auth.GoogleAuthProvider.PROVIDER_ID],tosUrl:termsPage,privacyPolicyUrl:termsPage};function generateSignin(){document.querySelector(".login-form").innerHTML='<div id="firebaseui-auth-container"></div>',ui.start("#firebaseui-auth-container",uiConfig)}null!=document.getElementsByClassName("page-login")&&(document.querySelector(".loading-screen").style.display="flex",window.onload=function(){firebase.auth().onAuthStateChanged(function(e){e?window.location.href=appPage:(document.querySelector(".loading-screen").style.display="none",document.querySelector(".login").classList.add("main"),generateSignin())})})}function writeUserData(e,n,t){var a={id:e,username:n,email:t,premium:"no"},i={};return i["users/"+e]=a,firebase.database().ref().update(i)}function signInCheck(){firebase.auth().onAuthStateChanged(function(e){e?(isLoggedIn=!0,userName=e.displayName,userEmail=e.email,userId=e.uid,userImage=e.photoURL,toDisplay=null==userEmail?userName:userEmail,null==userImage?textOrImage="Logged in as ":textOrImage='<img class="shadow" src="'+userImage+'"/>',document.querySelector(".username").innerHTML=textOrImage,document.querySelector(".username").className+=" username--visible",appReady()):window.location.href=loginPage})}function updateElements(){closeBtn=document.querySelectorAll(".close"),updateEvents()}function updateEvents(){closeBtn.forEach(function(e){e.addEventListener("click",function(){this.parentNode.remove()})})}function appReady(){if(document.getElementById("logout").addEventListener("click",function(){firebase.auth().signOut(),window.location.href=homePage}),"page__directory"==document.body.className){readCampaignList();var e=firebase.database().ref().child("campaigns").push().key;document.getElementById("create").href=editorPage+"?create=true&id="+e}"page__app"==document.body.className&&(console.log("navigated to app.html"),campaignInfo.id=getUrlVars().id,campaignInfo.title=document.getElementById("document-title").innerHTML,campaignInfo.text="",getUrlVars().create?(createCampaign(campaignInfo),setTimeout(function(){document.querySelector(".loading-screen").style.display="none"},300)):readCampaignInfo(campaignInfo.id),(quill=new Quill("#document-content",{modules:{toolbar:[[{header:[1,2,3,4,5,6,!1]}],[{font:[]}],["bold","italic","underline","strike",{align:[]}],["link"],[{color:[]}],[{list:"ordered"},{list:"bullet"}]]},theme:"snow"})).on("text-change",function(){changesMade()}),document.getElementById("command").addEventListener("submit",function(){commandHandler(document.getElementById("commandInput").value)}),document.getElementById("save").addEventListener("click",function(){displaySavedChanges(),saveCampaign({text:JSON.stringify(quill.getContents()),title:document.getElementById("document-title").innerHTML,blocks:encodeHTML(document.getElementById("document-blocks").innerHTML)},campaignInfo.id)}),setInterval(function(){displaySavedChanges("auto"),saveCampaign({text:JSON.stringify(quill.getContents()),title:document.getElementById("document-title").innerHTML,blocks:encodeHTML(document.getElementById("document-blocks").innerHTML)},campaignInfo.id)},3e5))}function createCampaign(e){var n={title:campaignInfo.title,text:campaignInfo.text},t={};t["users/"+userId+"/campaigns/"+getUrlVars().id]=n,setTimeout(function(){return firebase.database().ref().update(t)},750)}function readCampaignList(){return setTimeout(function(){document.querySelector(".loading-screen").style.display="none"},300),firebase.database().ref("/users/"+userId+"/campaigns").once("value").then(function(e){var n={size:0,title:"Undefined",size:0};for(var t in e.val()){n.size+=1;var a=document.createElement("div");for(var i in e.val()[t])n.title=e.val()[t].title;a.className="campaign shadow camp_"+t,a.innerHTML='<a href="/editor?id='+t+'"><span><i class="icon-folder"></i> '+n.title+'</span></a><i class="icon-x delete" data-key="'+t+'" alt="delete campaign" title="delete campaign"></i>',campaignList.append(a)}firebase.database().ref("/users/"+userId).once("value").then(function(e){"yes"!=e.val().premium?(document.getElementById("premiumBar").style.display="block",document.getElementById("count").innerHTML=n.size+"/4",n.size>4&&document.getElementById("createBlock").remove()):document.getElementById("premium-user").innerHTML='<i class="icon-award"></i> Supporter'}),document.querySelectorAll(".delete").forEach(function(e){e.addEventListener("click",function(){keyTodelete=e.dataset.key,1==confirm("Are you sure you want to delete this campaign?")&&(deleteCampaign(keyTodelete),location.reload())})})})}function deleteCampaign(e){return firebase.database().ref("/users/"+userId+"/campaigns/"+e).remove()}function saveCampaign(e,n){var t={title:e.title,text:e.text},a={};return a["users/"+userId+"/campaigns/"+n]=t,firebase.database().ref().update(a)}function readCampaignInfo(e){return firebase.database().ref("/users/"+userId+"/campaigns/"+e).once("value").then(function(e){var n={title:"Your first campaign",text:"",blocks:""};for(var t in e.val())n.title=e.val().title,n.text=e.val().text;document.getElementById("document-title").innerHTML=n.title,""!=n.text&&(quill.setContents(JSON.parse(n.text)),quillLoaded=!0),updateElements(campaignInfo),setTimeout(function(){document.querySelector(".loading-screen").style.display="none"},300)})}function getUrlVars(){var e={};window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(n,t,a){e[t]=a});return e}function setUniq(){return(new Date).getTime()}function displaySavedChanges(e){"auto"==e?(document.getElementById("save-message").innerHTML="Auto-saved",document.getElementById("save").classList.remove("changes"),setTimeout(function(){document.getElementById("save-message").innerHTML="Save"},1500)):(document.getElementById("save-message").innerHTML="Saved",document.getElementById("save").classList.remove("changes"),setTimeout(function(){document.getElementById("save-message").innerHTML="Save"},1500))}function changesMade(){!0===quillLoaded&&document.getElementById("save").classList.add("changes")}function encodeHTML(e){return encodeURI(e)}function commandHandler(e){var n=document.createElement("li");if("/help"==e)n.innerHTML='<i class="icon-chevron-right"></i> Available commands:<br>/roll (Ex. /roll 1 20)<br>/clear (Clear commands)<br>/help (View list of commands)',commandList.appendChild(n);else if(e.includes("/roll",0)){var t=e.split(/\s+/).slice(1,3),a=t[0],o=t[1];if(commandList.appendChild(n),void 0==a&&void 0==o)n.innerHTML='<i class="icon-chevron-right"></i> No dice type or amount included.';else if(void 0==o){n.innerHTML='<i class="icon-chevron-right"></i> D'+a+" rolled:",(r=document.createElement("li")).innerHTML='<i class="icon-chevron-right"></i> '+rollDice(a),commandList.appendChild(r)}else for(n.innerHTML='<i class="icon-chevron-right"></i> D'+o+" rolled "+a+" times:",i=0;a>i;i++){var r;(r=document.createElement("li")).innerHTML='<i class="icon-chevron-right"></i> '+rollDice(o),commandList.appendChild(r)}}else e.includes("/clear",0)?commandList.innerHTML="":(n.innerHTML='<i class="icon-chevron-right"></i> Unknown command. Try /help to view commands.',commandList.appendChild(n));document.getElementById("command").reset()}function rollDice(e){return Math.floor(Math.random()*e)+1}"page__app"!=document.body.className&&"page__directory"!=document.body.className||signInCheck(),"page__index"==document.body.className&&console.log("navigated to index.html");