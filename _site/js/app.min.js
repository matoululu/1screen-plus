var userName,userEmail,userId,quill,appPage="/campaigns",termsPage="/terms",homePage="/",loginPage="/login",editorPage="/editor",userPremium=!1,campaignInfo=new Object,campaignList=document.getElementById("campaignList"),quillLoaded=!1,commandList=document.getElementById("commands");if("page__login"==document.body.className){console.log("navigated to login.html");var uiConfig={callbacks:{signInSuccessWithAuthResult:function(e,t){return!0}},credentialHelper:firebaseui.auth.CredentialHelper.NONE,signInFlow:"popup",signInSuccessUrl:appPage,signInOptions:[firebase.auth.EmailAuthProvider.PROVIDER_ID,firebase.auth.TwitterAuthProvider.PROVIDER_ID,firebase.auth.FacebookAuthProvider.PROVIDER_ID,firebase.auth.GoogleAuthProvider.PROVIDER_ID],tosUrl:termsPage,privacyPolicyUrl:termsPage};function generateSignin(){document.querySelector(".login-form").innerHTML='<div id="firebaseui-auth-container"></div>',ui.start("#firebaseui-auth-container",uiConfig)}null!=document.getElementsByClassName("page-login")&&(document.querySelector(".loading-screen").style.display="flex",window.onload=function(){firebase.auth().onAuthStateChanged(function(e){e?window.location.href=appPage:(document.querySelector(".loading-screen").style.display="none",document.querySelector(".login").classList.add("main"),generateSignin())})})}function writeUserData(e,t,n){var i={id:e,username:t,email:n,premium:"no"},a={};return a["users/"+e]=i,firebase.database().ref().update(a)}function signInCheck(){firebase.auth().onAuthStateChanged(function(e){e?(isLoggedIn=!0,userName=e.displayName,userEmail=e.email,userId=e.uid,userImage=e.photoURL,toDisplay=null==userName?userEmail:"Hi, "+userName,document.querySelector(".username").innerHTML=toDisplay,document.querySelector(".username").className+=" username--visible",appReady()):window.location.href=loginPage})}function updateElements(){closeBtn=document.querySelectorAll(".close"),updateEvents()}function updateEvents(){closeBtn.forEach(function(e){e.addEventListener("click",function(){this.parentNode.remove()})})}function appReady(){if(document.getElementById("logout").addEventListener("click",function(){firebase.auth().signOut(),window.location.href=homePage}),isPremium(),"page__directory"==document.body.className){readCampaignList();var e=setUniq();document.getElementById("create").href=editorPage+"?create=true&id="+e}"page__app"==document.body.className&&(console.log("navigated to app.html"),campaignInfo.id=getUrlVars().id,campaignInfo.title=document.getElementById("document-title").innerHTML,campaignInfo.text="",getUrlVars().create?(createCampaign(campaignInfo),setTimeout(function(){document.querySelector(".loading-screen").style.display="none"},300)):readCampaignInfo(campaignInfo.id),quillNotes=new Quill("#document-notes",{modules:{toolbar:[["bold","italic","underline"],["link"],[{list:"ordered"},{list:"bullet"}]]},theme:"snow"}),(quill=new Quill("#document-content",{modules:{toolbar:[[{header:[1,2,3,4,5,6,!1]}],[{font:[]}],["bold","italic","underline","strike",{align:[]}],["link"],[{color:[]}],[{list:"ordered"},{list:"bullet"}]]},theme:"snow"})).on("text-change",function(){changesMade()}),document.getElementById("command").addEventListener("submit",function(){commandHandler(document.getElementById("commandInput").value)}),document.getElementById("notes").addEventListener("click",function(){this.classList.contains("is-open")?(this.innerHTML='<i class="icon-edit-2"></i> Notes',this.classList.remove("is-open"),document.getElementById("notes-editor").classList.remove("is-active"),document.getElementById("terminal").classList.add("is-active")):(this.classList.add("is-open"),this.innerHTML='<i class="icon-terminal"></i> Commands',document.getElementById("terminal").classList.remove("is-active"),document.getElementById("notes-editor").classList.add("is-active"))}),document.getElementById("save").addEventListener("click",function(){displaySavedChanges(),saveCampaign({text:JSON.stringify(quill.getContents()),notes:JSON.stringify(quillNotes.getContents()),title:document.getElementById("document-title").innerHTML,blocks:encodeHTML(document.getElementById("document-blocks").innerHTML)},campaignInfo.id)}),setInterval(function(){displaySavedChanges("auto"),saveCampaign({text:JSON.stringify(quill.getContents()),title:document.getElementById("document-title").innerHTML,blocks:encodeHTML(document.getElementById("document-blocks").innerHTML)},campaignInfo.id)},3e5))}function createCampaign(e){var t={title:campaignInfo.title,text:campaignInfo.text},n={};n["users/"+userId+"/campaigns/"+getUrlVars().id]=t,setTimeout(function(){return firebase.database().ref().update(n)},750)}function readCampaignList(){return setTimeout(function(){document.querySelector(".loading-screen").style.display="none"},300),tipGenerator(),firebase.database().ref("/users/"+userId+"/campaigns").once("value").then(function(e){var t={size:0,title:"Undefined",size:0};for(var n in e.val()){t.size+=1;var i=document.createElement("div");for(var a in e.val()[n])t.title=e.val()[n].title;i.className="campaign shadow camp_"+n,i.innerHTML='<a href="/editor?id='+n+'"><span><i class="icon-folder"></i> '+t.title+'</span></a><i class="icon-x delete" data-key="'+n+'" alt="delete campaign" title="delete campaign"></i>',campaignList.append(i)}firebase.database().ref("/users/"+userId).once("value").then(function(e){"yes"!=e.val().premium&&(document.getElementById("premiumBar").style.display="block",document.getElementById("count").innerHTML=t.size+"/6",t.size>6&&document.getElementById("createBlock").remove())}),document.querySelectorAll(".delete").forEach(function(e){e.addEventListener("click",function(){keyTodelete=e.dataset.key,1==confirm("Are you sure you want to delete this campaign?")&&(deleteCampaign(keyTodelete),location.reload())})})})}function deleteCampaign(e){return firebase.database().ref("/users/"+userId+"/campaigns/"+e).remove()}function saveCampaign(e,t){var n={title:e.title,text:e.text,notes:e.notes},i={};return i["users/"+userId+"/campaigns/"+t]=n,firebase.database().ref().update(i)}function readCampaignInfo(e){return firebase.database().ref("/users/"+userId+"/campaigns/"+e).once("value").then(function(e){var t={title:"Your first campaign",text:"",notes:""};for(var n in e.val())t.title=e.val().title,t.text=e.val().text,t.notes=e.val().notes;document.getElementById("document-title").innerHTML=t.title,""!=t.text&&(quill.setContents(JSON.parse(t.text)),void 0!=t.notes&&quillNotes.setContents(JSON.parse(t.notes)),quillLoaded=!0),updateElements(campaignInfo),setTimeout(function(){document.querySelector(".loading-screen").style.display="none"},300)})}function getUrlVars(){var e={};window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(t,n,i){e[n]=i});return e}function setUniq(){return(new Date).getTime()}function displaySavedChanges(e){"auto"==e?(document.getElementById("save-message").innerHTML="Auto-saved",document.getElementById("save").classList.remove("changes"),setTimeout(function(){document.getElementById("save-message").innerHTML="Save"},1500)):(document.getElementById("save-message").innerHTML="Saved",document.getElementById("save").classList.remove("changes"),setTimeout(function(){document.getElementById("save-message").innerHTML="Save"},1500))}function changesMade(){!0===quillLoaded&&document.getElementById("save").classList.add("changes")}function encodeHTML(e){return encodeURI(e)}function commandHandler(e){var t=document.createElement("li");if("/help"==e)t.innerHTML='<i class="icon-chevron-right"></i> Available commands:<br>/roll (Ex. /roll 1 20)<br>/clear (Clear commands)<br>/help (View list of commands)',commandList.appendChild(t);else if(e.includes("/roll",0)){var n=e.split(/\s+/).slice(1,3),a=n[0],o=n[1];if(commandList.appendChild(t),void 0==a&&void 0==o)t.innerHTML='<i class="icon-chevron-right"></i> No dice type or amount included.';else if(void 0==o){t.innerHTML='<i class="icon-chevron-right"></i> D'+a+" rolled:",(s=document.createElement("li")).innerHTML='<i class="icon-chevron-right"></i> '+rollDice(a),commandList.appendChild(s)}else for(t.innerHTML='<i class="icon-chevron-right"></i> D'+o+" rolled "+a+" times:",i=0;a>i;i++){var s;(s=document.createElement("li")).innerHTML='<i class="icon-chevron-right"></i> '+rollDice(o),commandList.appendChild(s)}}else e.includes("/clear",0)?commandList.innerHTML="":(t.innerHTML='<i class="icon-chevron-right"></i> Unknown command. Try /help to view commands.',commandList.appendChild(t));document.getElementById("command").reset()}function rollDice(e){return Math.floor(Math.random()*e)+1}function isPremium(){}"page__app"!=document.body.className&&"page__directory"!=document.body.className||signInCheck(),"page__index"==document.body.className&&console.log("navigated to index.html");var tipsArray=["<h3>Did you know?</h3><p>Your changes save automatically every 5 minutes.</p>",'<h3>Did you know?</h3><p>You can store useful snippets by clicking the "notes" button.</p>',"<h3>Did you know?</h3><p>1Screen Supporters have unlimited campaign slots!</p>"];function tipGenerator(){var e=tipsArray[Math.floor(Math.random()*tipsArray.length)];document.getElementById("tip").innerHTML=e}